
////////////////////////////////////////////////////////////////////////////////
/////////////////////////         SISTEMA RIPS         /////////////////////////
/////////////////////////      PIJAOS SALUD EPSI      //////////////////////////
///////////////////              JS CARGAR_RIPS              ///////////////////
/////////////////////////  DEPARTAMENTO DE DESARROLLO  /////////////////////////
/////////////////////////  AMBITO: PROCESAMIENTO RIPS  /////////////////////////
////////          METODOS JS PARA EL PROCESAMIENTO DE INFORMACION        ///////
////////////////////////////////////////////////////////////////////////////////


var solo_numeros=/^\d*$/;function init(){reenvio();const e=document.querySelector("#input-rips input[type=file]");e.onchange=(()=>{if(e.files.length>0){document.querySelector("#input-rips .file-name").textContent=e.files[0].name}}),$(".delete").click(function(){$(".modal").removeClass("is-active")}),$("#closeModal").click(function(){$(".modal").removeClass("is-active")})}function reenvio(){window.history.replaceState&&window.history.replaceState(null,null,window.location.href)}function modal_carga(){$(".loadingpage").fadeOut("slow")}function validarSubida(){return solo_numeros.test($("#txtNremision").val())&&""!==$("#txtNremision").val()?"C"!==$("#smodalidad option:selected").val()&&"E"!==$("#smodalidad option:selected").val()?($("#smodalidad").focus(),alerta("Modalidad no válida","Debe elegir una opción Cápita / Evento"),!1):""===$("#archivo").val()?($("#archivo").focus(),alerta("Archivo no válido","Debe cargar un fichero"),!1):1===val_peso_ext()?($("#archivo").focus(),alerta("Archivo no válido","Debe cargar un archivo comprimido en formato .ZIP"),!1):2===val_peso_ext()?($("#archivo").focus(),alerta("Archivo no válido","Tamaño de archivo no permitido, debe ser menor a 10 MB"),!1):$("#archivo").prop("files")[0].name.slice(0,-4)!==$("#txtNremision").val()?($("#txtNremision").focus(),alerta("Datos no válidos","La remisión digitada no corresponde a la relacionada en el archivo"),!1):(modal_procesamiento(),void $("#proceso").addClass("is-loading")):($("#txtNremision").focus(),alerta("Remisión no válida","Debe ingresar un valor de tipo entero"),!1)}function val_peso_ext(){var e=document.getElementsByName("archivo"),a=e[0].files[0].name.split(".").pop(),o=e[0].files[0].size;return"zip"!==(a=a.toLowerCase())?1:o>1e7?2:0}function modal_procesamiento(){$("#modal_rips").addClass("is-active"),$("#modal_rips_msg").html("Esta tarea puede tardar dependiendo de la cantidad de registros a validar.")}function alerta(e,a){alertify.alert().setting({title:e,label:"Aceptar",message:'<i class="fas fa-exclamation-triangle"></i> '+a+"."}).show()}function envio_rips(e,a){alertify.confirm('<i class="zmdi zmdi-notifications-active"></i> Esta remisión se grabara en modalidad <strong>'+a+"</strong>. ¿Desea continuar?.").set({title:"¿Esta seguro de grabar la remisión: "+e+"?"}).set({labels:{ok:"Aceptar",cancel:"Cancelar"}}).set("onok",function(){$('<form action="grabar_rips.php" method="post">\n                    <input type="hidden" name="datos_grabar" value="1"></input>\n                </form>').appendTo("body").submit().remove(),$("#grabar").attr("disabled",!0),$("#modal_rips").addClass("is-active"),$("#modal_rips_msg").html("Preparando la información para iniciar con la inserción de datos, espere un momento.")}).set("onclose",function(){$("#grabar").focus()}).set("defaultFocus","cancel")}function envio_novedades(e){var a;switch(e){case 1:a="La extensión, tamaño del archivo o número de remisión no son correctos.";break;case 2:a="Esta remisión ya se encuentra registrada en el sistema. Verifique e intente de nuevo.";break;case 3:a="Los datos de la remisión no corresponde con el del prestador actual.";break;case 4:a="El código Reps o Nit del prestador no estan registrados en el sistema.";break;case 5:a="Ocurrió un error y el archivo no se pudo validar y/o formato no es ZIP.";break;case 6:a="Este archivo intento cargarse en un envío anterior, inicie el proceso de nuevo.";break;case 7:a="No se encuentran los datos requeridos para iniciar el proceso de validación."}$("#modal_novedad").html("<div class='modal is-active'> \n <div class='modal-background'></div> \n <div class='modal-card'> \n <header class='modal-card-head'> \n <p class='modal-card-title'> \n <strong>No se puede procesar el archivo</strong> \n </p>  \n  <button class='delete' aria-label='close' onclick='cerrar_modal()'></button> \n  </header> \n  <section class='modal-card-body'> \n <p class='has-text-justified'>"+a+"</p> \n </section> \n <footer class='modal-card-foot has-text-centered'> \n <button class='button is-info' onclick='cerrar_modal()'> \n <span class='icon is-small'> <i class='fas fa-exclamation-triangle'></i></span>   \n  <span> Aceptar </span> \n  </button> \n  </footer> \n  </div>\n  </div>")}function cerrar_modal(){$(".modal").removeClass("is-active")}function log_txt(e){$('<form action="../../reportes/log_errores.php" method="post" target="_blank"> \n <input type="hidden" name="values_array" value="'+e+'"></input> \n </form>').appendTo("body").submit().remove()}function recarga(e){switch(e){case 0:$("#carga").hide(),$("#total_error").hide(),$("#pantalla_rips").show(),$("#txtNremision").focus();break;case 1:$("#msg_val_inicial").hide(),$("#val_inicial").hide(),$("#txtNremision").focus();break;case 2:$("#carga").hide(),$("#total_error").hide(),$("#grabar_datos").hide(),$("#pantalla_rips").show(),$("#txtNremision").focus()}}init();

////////////////////////////////////////////////////////////////////////////////
/////////////////////////         SISTEMA RIPS         /////////////////////////
/////////////////////////      PIJAOS SALUD EPSI      //////////////////////////
///////////////////              JS BUSCAR_RIPS              ///////////////////
/////////////////////////  DEPARTAMENTO DE DESARROLLO  /////////////////////////
/////////////////////////  AMBITO: PROCESAMIENTO RIPS  /////////////////////////
////////          METODOS JS PARA EL PROCESAMIENTO DE INFORMACION        ///////
////////////////////////////////////////////////////////////////////////////////


var tabla,tabla_prestadores,tabla_facturas;function init(){carga_vacia(),carga_vacia_prestador(),cargarDatarange(),$("#nueva").attr("disabled",!0)}function carga_vacia(){tabla=$("#tbllistado").dataTable({dom:"Bfrtip",buttons:["copyHtml5","excelHtml5"]}).DataTable()}function carga_vacia_prestador(){tabla_prestadores=$("#tbllistadoprestador").dataTable({dom:"Bfrtip",buttons:[]}).DataTable()}function listar(){if(1===validar_campos()){$("#filtrar").html("Consultando..."),$("#filtrar").attr("disabled",!0);var a=$("#rango_fechas").val().split(" / "),t=a[0],r=a[a.length-1],e=$("#nit_prestador").val(),o=$("#smodalidad").val();tabla=$("#tbllistado").dataTable({aProcessing:!0,aServerSide:!0,dom:"Bfrtip",buttons:["copyHtml5","excelHtml5"],columnDefs:[{className:"dt-body-center",targets:[0,1,2,3,4,5]}],ajax:{url:"../../controladores/rips.php?op=buscar_remisiones",data:{fecha_inicial:t,fecha_final:r,nit_prestador:e,smodalidad:o},type:"get",dataType:"json",error:function(a){console.log(a.responseText)}},initComplete:function(a,t){t.aaData.length>0?($("#nueva").removeAttr("disabled"),$("#filtrar").html("<i class='zmdi zmdi-search-in-file'></i> &nbsp; Buscar")):($("#filtrar").removeAttr("disabled"),$("#filtrar").html("<i class='zmdi zmdi-search-in-file'></i> &nbsp; Buscar"))},bDestroy:!0,iDisplayLength:10,order:[[2,"desc"]]}).DataTable()}}function validar_campos(){var a=1;return""===$("#nit_prestador").val()?($("#nit_prestador").focus(),a=0):""===$("#smodalidad").val()&&($("#smodalidad").focus(),a=0),a}function mostrar_bprestador(a){a?$("#modal_bprestador").addClass("is-active"):($("#tbllistadoprestador").dataTable().fnClearTable(),$("#nomb_prestador").val(""),$("#modal_bprestador").removeClass("is-active"))}function listar_bprestador(){if(""!==$("#nomb_prestador").val().trim()){$("#filtrar_prestador").attr("disabled",!0);var a=$("#nomb_prestador").val();tabla_prestadores=$("#tbllistadoprestador").dataTable({aProcessing:!0,aServerSide:!0,dom:"Bfrtip",buttons:[],columnDefs:[{className:"dt-body-center",targets:[0,1,2,4,5]},{width:"5%",targets:0},{width:"10%",targets:1},{width:"10%",targets:2}],ajax:{url:"../../controladores/rips.php?op=buscar_prestador",data:{nomb_prestador:a},type:"get",dataType:"json",error:function(a){console.log(a.responseText)}},initComplete:function(){$("#filtrar_prestador").removeAttr("disabled")},bDestroy:!0,iDisplayLength:5,order:[[2,"desc"]]}).DataTable()}else $("#nomb_prestador").focus()}function asignar_nit(a){$("#nit_prestador").val(a),mostrar_bprestador(!1)}function mostrar_reporte(a,t){mostrarform(!0),encabezado_factura(a,t),datos_control(a,t),listar_facturas(a,t),valores_neto(a,t)}function encabezado_factura(a,t){$.post("../../controladores/rips.php?op=mostrar_encabezado",{nit_prestador:a,num_remision:t},function(a,t){a=JSON.parse(a),$("#cod_prestador").val(a.COD_PRESTADOR),$("#ni_prestador").val(a.NUM_ENTIDAD),$("#n_remision").val(a.NUM_REMISION),$("#modalidad").val(null==a.MOD_CONTRATO?"-- No Aplica --":a.MOD_CONTRATO),$("#fec_remision").val(a.F_REMISION),$("#no_prestador").val(a.NOM_PRESTADOR),$("#fec_registro").val(a.F_CARGUE)})}function datos_control(a,t){$.post("../../controladores/rips.php?op=datos_control",{nit_prestador:a,num_remision:t},function(a,t){a=JSON.parse(a),$("#datos_ct").html("");for(var r=0;r<a.length;r++){var e='<tr><td colspan="2" class="has-text-centered">'+a[r].ID_ARCHIVO+'</td><td class="has-text-centered">'+a[r].COD_ARCHIVO+'</td><td class="has-text-centered">'+a[r].F_REMISION+'</td><td class="has-text-centered">'+a[r].TOTAL_ARCHIVOS+"</td></tr>";$("#datos_ct").append(e)}})}function listar_facturas(a,t){tabla_facturas=$("#tblinfoaf").dataTable({aProcessing:!0,aServerSide:!0,dom:"Bfrtip",buttons:["copy","excelHtml5"],columnDefs:[{className:"dt-body-center",targets:[0,1,2,3,4,5]},{targets:[2,3,4,5],render:$.fn.dataTable.render.number(".",",",2,"$")}],ajax:{url:"../../controladores/rips.php?op=listar_facturas",data:{nit_prestador:a,num_remision:t},type:"post",dataType:"json",error:function(a){console.log(a.responseText)}},bDestroy:!0,iDisplayLength:10}).DataTable()}function valores_neto(a,t){$.post("../../controladores/rips.php?op=valores_neto",{nit_prestador:a,num_remision:t},function(a,t){a=JSON.parse(a),$("#copagos").text(formatear_valor(a.COPAGO)),$("#comisiones").text(formatear_valor(a.COMISION)),$("#descuento").text(formatear_valor(a.DESCUENTO)),$("#neto_rips").text(formatear_valor(a.TOTAL_NETO))})}function formatear_valor(a){return new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:2}).format(a)}function mostrarform(a){limpiar_detallado(),a?($("#formulario_busqueda").hide(),$("#informacio_af").show()):($("#formulario_busqueda").show(),$("#informacio_af").hide())}function limpiar(){$("#tbllistado").dataTable().fnClearTable(),$("#filtrar").removeAttr("disabled"),$("#nueva").attr("disabled",!0)}function limpiar_detallado(){$("#cod_prestador").val(""),$("#ni_prestador").val(""),$("#n_remision").val(""),$("#modalidad").val(""),$("#fec_remision").val(""),$("#no_prestador").val(""),$("#fec_registro").val(""),$("#datos_ct").html(""),$("#tblinfoaf").dataTable().fnClearTable(),$("#copagos").text(""),$("#comisiones").text(""),$("#descuento").text(""),$("#neto_rips").text("")}function cargarDatarange(){$("#rango_fechas").daterangepicker({locale:{format:"YYYY-MM-DD",separator:" / ",applyLabel:"Guardar",cancelLabel:"Cancelar",fromLabel:"Desde",toLabel:"Hasta",customRangeLabel:"Personalizar",daysOfWeek:["Do","Lu","Ma","Mi","Ju","Vi","Sa"],monthNames:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Setiembre","Octubre","Noviembre","Diciembre"],firstDay:1},opens:"right"})}init();

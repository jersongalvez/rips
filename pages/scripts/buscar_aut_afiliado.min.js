
////////////////////////////////////////////////////////////////////////////////
/////////////////////////         SISTEMA RIPS         /////////////////////////
/////////////////////////      PIJAOS SALUD EPSI      //////////////////////////
///////////////////          JS BUSCAR AUTORIZACION          ///////////////////
/////////////////////////  DEPARTAMENTO DE DESARROLLO  /////////////////////////
////////////////////  AMBITO: PROCESAMIENTO AUTORIZACIONES  ////////////////////
////////          METODOS JS PARA EL PROCESAMIENTO DE INFORMACION        ///////
////////////////////////////////////////////////////////////////////////////////



var tabla;function init(){carga_vacia(),$("#nueva").attr("disabled",!0)}function carga_vacia(){tabla=$("#tbllistado").dataTable({dom:"Bfrtip",buttons:[],columnDefs:[{className:"dt-body-center",targets:[0,1,2,3,4,5]},{targets:[2],visible:!1,searchable:!1}]}).DataTable()}function buscar_datosaut(){1===validar_campos()&&($("#filtrar").html("Consultando..."),$("#filtrar").attr("disabled",!0),buscar_afiliadoSub())}function buscar_afiliadoSub(){var a=$("#tip_documento").val(),s=$("#numd_afiliado").val();$.post("../../controladores/autorizacion.php?op=consultar_afiliadoSub",{tip_documento:a,numd_afiliado:s},function(a,s){try{!1!==(a=JSON.parse(a))?("C"==a[0].REGIMEN?($("#d_afiliado").append('<div class="column is-5"> <div class="field"> <strong>Nombre del afiliado:</strong> <label>'+a[0].NOMBRES+"</label> </div> </div>"),$("#d_afiliado").append('<div class="column is-2"> <div class="field"> <strong>Regimen:</strong> <label> MOVILIDAD </label> </div> </div>'),$("#d_afiliado").append('<div class="column is-2"> <div class="field"> <strong>Nivel:</strong> <label>'+a[0].NIVEL+"</label> </div> </div>"),$("#d_afiliado").append('<div class="column is-3"> <div class="field"> <strong>Tipo usuario:</strong> <label>'+a[0].TIPO_AFILIADO+"</label> </div> </div>")):"S"==a[0].REGIMEN&&($("#d_afiliado").append('<div class="column is-6"> <div class="field"> <strong>Nombre del afiliado:</strong> <label>'+a[0].NOMBRES+"</label> </div> </div>"),$("#d_afiliado").append('<div class="column is-3"> <div class="field"> <strong>Regimen:</strong> <label> SUBSIDIADO </label> </div> </div>'),$("#d_afiliado").append('<div class="column is-3"> <div class="field"> <strong>Nivel:</strong> <label>'+a[0].NIVEL+"</label> </div> </div>")),listar_aut(),$("#datos_afiliado").show(),$("#autorizaciones_afiliado").show(),$("#filtrar").html("<i class='zmdi zmdi-search-in-file'></i> &nbsp; Buscar"),$("#nueva").removeAttr("disabled"),$("#filtrar").attr("disabled",!0)):($("#modal_autorizacion").html("<div class='modal is-active'> \n                                                <div class='modal-background'></div> \n                                                <div class='modal-card'> \n                                                    <header class='modal-card-head'> \n                                                        <p class='modal-card-title'>\n                                                            <strong>Usuario no encontrado</strong>\n                                                        </p>  \n                                                            <button class='delete' aria-label='close'></button> \n                                                    </header> \n                                                    <section class='modal-card-body'> \n                                                        <p class='has-text-justified'> El usuario no está registrado en la base de datos única de la entidad. </p> \n                                                    </section> \n                                                    <footer class='modal-card-foot has-text-centered'> \n                                                        <button class='button is-info' id='closeModal'>\n                                                             <span class='icon is-small'> <i class='fas fa-exclamation-triangle'></i></span>   \n                                                             <span> Aceptar </span> \n                                                        </button> \n                                                    </footer> \n                                                </div>\n                                            </div>"),$(".delete").click(function(){$(".modal").removeClass("is-active")}),$("#closeModal").click(function(){$(".modal").removeClass("is-active")}),$("#filtrar").html("<i class='zmdi zmdi-search-in-file'></i> &nbsp; Buscar"),$("#filtrar").removeAttr("disabled"))}catch(a){$("#modal_autorizacion").html("<div class='modal is-active'> \n                                                <div class='modal-background'></div> \n                                                <div class='modal-card'> \n                                                    <header class='modal-card-head'> \n                                                        <p class='modal-card-title'>\n                                                            <strong>Sin conexión al servidor</strong>\n                                                        </p>  \n                                                            <button class='delete' aria-label='close'></button> \n                                                    </header> \n                                                    <section class='modal-card-body'> \n                                                        <p class='has-text-justified'> No es posible consultar las autorizaciones asociadas al usuario en estos momentos. </p> \n                                                    </section> \n                                                    <footer class='modal-card-foot has-text-centered'> \n                                                        <button class='button is-info' id='closeModal'>\n                                                             <span class='icon is-small'> <i class='fas fa-exclamation-triangle'></i></span>   \n                                                             <span> Aceptar </span> \n                                                        </button> \n                                                    </footer> \n                                                </div>\n                                            </div>"),$(".delete").click(function(){$(".modal").removeClass("is-active")}),$("#closeModal").click(function(){$(".modal").removeClass("is-active")}),$("#filtrar").html("<i class='zmdi zmdi-search-in-file'></i> &nbsp; Buscar"),$("#filtrar").removeAttr("disabled")}})}function listar_aut(){var a=$("#nit_prestador").val(),s=$("#tip_documento").val(),i=$("#numd_afiliado").val();tabla=$("#tbllistado").dataTable({aProcessing:!0,aServerSide:!0,dom:"Bfrtip",buttons:[],columnDefs:[{className:"dt-body-center",targets:[0,1,2,3,4,5]},{targets:[2],visible:!1,searchable:!1}],ajax:{url:"../../controladores/autorizacion.php?op=buscar_autafiliado",data:{nit_prestador:a,tip_documento:s,numd_afiliado:i},type:"get",dataType:"json",error:function(a){console.log(a.responseText)}},bDestroy:!0,iDisplayLength:20,order:[[5,"asc"]]}).DataTable(),$("#tbllistado tbody").on("click",".details-control",function(){var a=$(this).closest("tr"),s=tabla.row(a);s.child.isShown()?(s.child.hide(),a.removeClass("shown"),$("#"+s.data()[2]).removeClass("is-danger"),$("#"+s.data()[2]).addClass("is-link"),$("#"+s.data()[2]).html('<span class="icon is-small"> <i class="zmdi zmdi-plus"></i>')):(s.child(buscar_sau(s.data())).show(),a.addClass("shown"),$("#"+s.data()[2]).removeClass("is-link"),$("#"+s.data()[2]).addClass("is-danger"),$("#"+s.data()[2]).html('<span class="icon is-small"> <i class="zmdi zmdi-minus"></i>'))})}function buscar_sau(a){var s=$("<div/>").addClass("loading").text("Consultando...");return $.ajax({url:"../../controladores/autorizacion.php?op=buscar_servicioautorizado",data:{n_solicitud:a[2]},dataType:"json",success:function(a){for(var i=[],t=0;t<a.length;t++){var l='<tr><td class="has-text-centered">'+a[t].CD_SERVICIO+'</td><td class="has-text-centered">'+a[t].CANTIDAD+'</td><td class="has-text-justified">'+a[t].OBSERVACION+"</td></tr>";i.push(l)}i=(i=i.toString()).replace(/,/g,""),s.html('<table class="table is-bordered" style="width: 100%;"> \n                    <thead> \n                        <tr> \n                            <th colspan="3" class="has-text-centered">Servicios autorizados</th> \n                        </tr> \n                        <tr> \n                            <th class="has-text-centered">Codigo</th> \n                            <th class="has-text-centered">Cant.</th> \n                            <th class="has-text-centered">Descripci&oacute;n del servicio</th> \n                        </tr> \n                    </thead> \n                    <tbody>'+i+"</tbody> \n                </table>").removeClass("loading")},error:function(a){console.log(a.responseText)}}),s}function aceptar_servicio(a){alertify.confirm('<i class="zmdi zmdi-notifications-active"></i> ¿Confirma que se prestaron los servicios asociados a esta autorización?').set({title:"Confirmar servicio"}).set({labels:{ok:"Aceptar",cancel:"Cancelar"}}).set("onok",function(s){$.post("../../controladores/autorizacion.php?op=aceptar_servicio",{n_solicitud:a},function(a){alertify.alert().setting({title:"Estado de la solicitud",label:"Aceptar",message:'<i class="zmdi zmdi-info"></i> '+a+"."}).show(),tabla.ajax.reload()})})}function validar_campos(){var a=1;return""===$("#nit_prestador").val()?($("#nit_prestador").focus(),a=0):""===$("#tip_documento").val()?($("#tip_documento").focus(),a=0):""===$("#numd_afiliado").val()&&($("#numd_afiliado").focus(),a=0),a}function limpiar(){$("#tbllistado tbody").remove(),$("#tbllistado").dataTable().fnClearTable(),$("#filtrar").removeAttr("disabled"),$("#nueva").attr("disabled",!0),$("#nom_afiliado").text(""),$("#reg_afiliado").text(""),$("#d_afiliado").empty(),$("#datos_afiliado").hide(),$("#autorizaciones_afiliado").hide()}init();